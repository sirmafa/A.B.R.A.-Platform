<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A.B.R.A. AWS Connection Test</title>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1490.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #1a1a1a; color: white; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: #2d5a2d; border: 1px solid #4a8a4a; }
        .error { background: #5a2d2d; border: 1px solid #8a4a4a; }
        .info { background: #2d2d5a; border: 1px solid #4a4a8a; }
        button { padding: 10px 20px; margin: 5px; background: #0066cc; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0052a3; }
        pre { background: #333; padding: 10px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üõ°Ô∏è A.B.R.A. Platform - AWS Connection Test</h1>
    
    <div id="status"></div>
    
    <button onclick="testConnection()">Test AWS Connection</button>
    <button onclick="testDynamoDB()">Test DynamoDB</button>
    <button onclick="testIAM()">Test IAM Permissions</button>
    
    <div id="results"></div>

    <script>
        // AWS Configuration
        AWS.config.update({
            region: 'us-east-1',
            credentials: new AWS.CognitoIdentityCredentials({
                IdentityPoolId: 'us-east-1:76e78d3a-ca17-45b1-a3ea-5e1dffa721ea'
            })
        });

        const dynamodb = new AWS.DynamoDB.DocumentClient();
        const iam = new AWS.IAM();

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = message;
            document.getElementById('status').appendChild(div);
        }

        function showResult(title, data) {
            const div = document.createElement('div');
            div.innerHTML = `<h3>${title}</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
            document.getElementById('results').appendChild(div);
        }

        async function testConnection() {
            log('Testing AWS SDK connection...', 'info');
            try {
                await AWS.config.credentials.getPromise();
                log('‚úÖ AWS SDK connected successfully', 'success');
                log(`Identity ID: ${AWS.config.credentials.identityId}`, 'info');
            } catch (error) {
                log(`‚ùå AWS connection failed: ${error.message}`, 'error');
            }
        }

        async function testDynamoDB() {
            log('Testing DynamoDB access...', 'info');
            try {
                // Test table scan
                const result = await dynamodb.scan({
                    TableName: 'ABRA-DLT-Ledger',
                    Limit: 1
                }).promise();
                
                log('‚úÖ DynamoDB access successful', 'success');
                showResult('DynamoDB Scan Result', result);
                
                // Test write operation
                const testItem = {
                    anchorId: 'test-' + Date.now(),
                    hash: '0123456789abcdef'.repeat(4),
                    type: 'TEST',
                    timestamp: Date.now(),
                    blockHeight: 1
                };
                
                await dynamodb.put({
                    TableName: 'ABRA-DLT-Ledger',
                    Item: testItem
                }).promise();
                
                log('‚úÖ DynamoDB write test successful', 'success');
                showResult('Test Item Written', testItem);
                
            } catch (error) {
                log(`‚ùå DynamoDB test failed: ${error.message}`, 'error');
                showResult('DynamoDB Error', error);
            }
        }

        async function testIAM() {
            log('Testing IAM permissions...', 'info');
            try {
                // Test IAM list roles (should work with current permissions)
                const result = await iam.listRoles({ MaxItems: 1 }).promise();
                log('‚úÖ IAM access successful', 'success');
                showResult('IAM List Roles Result', result);
                
            } catch (error) {
                log(`‚ùå IAM test failed: ${error.message}`, 'error');
                showResult('IAM Error', error);
            }
        }

        // Auto-test on load
        window.onload = function() {
            log('A.B.R.A. Platform AWS Connection Test', 'info');
            log('Identity Pool: us-east-1:76e78d3a-ca17-45b1-a3ea-5e1dffa721ea', 'info');
            log('DynamoDB Table: ABRA-DLT-Ledger', 'info');
            testConnection();
        };
    </script>
</body>
</html>